let data = {
    title: [
        "Back To Black",
        "Skyfall",
        "It's A Man's, Man's, Man's World",
    ],
    singer: [
        "Amy Winehouse",
        "Adele",
        "James Brown",
    ],
    song: [
        "music/Amy_Winehouse-Back_To_Black.mp3",
        "music/Adele-Skyfall.mp3",
        "music/James Brown â€“ It's A Man's, Man's, Man's World.mp3",
    ],
    poster: [
        "images/amy-winehouse-back-2-high.jpg",
        "images/Skyfall.png",
        "images/James_Brown_the_man_world.jpg",
    ],
    shadow: [
        "0 0 50px 10px rgb(57 121 249 / 50%), 0 0 100px 20px rgba(165, 192, 255, 0.7)",
        "0 0 50px 10px rgb(0 89 94), 0 0 100px 20px rgb(1 92 94)",
        "0 0 50px 10px rgba(255, 255, 255, 0.5), 0 0 100px 20px rgba(255, 255, 255, 0.3)",

    ],
    lyrics: [
        [
            { time: 0, text: "..." },
            { time: 16, text: "He left no time to regret" },
            { time: 22, text: "Kept his lips wet" },
            { time: 25, text: "With his same old safe bet" },
            { time: 31, text: "Me and my head high" },
            { time: 37, text: "And my tears dry" },
            { time: 40, text: "Get on without my guy" },
            { time: 46, text: "You went back to what you knew" },
            { time: 53, text: "So far removed" },
            { time: 56, text: "From all that we went through" },
            { time: 62, text: "And I tread a troubled track" },
            { time: 68, text: "My odds are stacked" },
            { time: 72, text: "I'll go back to black" },
            { time: 78, text: "We only said goodbye with words" },
            { time: 82, text: "I died a hundred times" },
            { time: 86, text: "You go back to her" },
            { time: 89, text: "And I go back to" },
            { time: 93, text: "I go back to us" },
            { time: 99, text: "I love you much" },
            { time: 103, text: "It's not enough" },
            { time: 105, text: "You love blow and I love puff" },
            { time: 112, text: "And life is like a pipe" },
            { time: 118, text: "And I'm a tiny penny rolling up the walls inside" },
            { time: 129, text: "We only said goodbye with words" },
            { time: 133, text: "I died a hundred times" },
            { time: 137, text: "You go back to her" },
            { time: 140, text: "And I go back to" },
            { time: 143, text: "We only said goodbye with words" },
            { time: 148, text: "I died a hundred times" },
            { time: 152, text: "You go back to her" },
            { time: 155, text: "And I go back to" },
            { time: 158, text: "..." },
            { time: 164, text: "Black, black, black, black" },
            { time: 181, text: "Black, black, black" },
            { time: 194, text: "I go back to" },
            { time: 198, text: "I go back to" },
            { time: 202, text: "We only said goodbye with words" },
            { time: 206, text: "I died a hundred times" },
            { time: 210, text: "You go back to her" },
            { time: 213, text: "And I go back to" },
            { time: 218, text: "We only said goodbye with words" },
            { time: 222, text: "I died a hundred times" },
            { time: 225, text: "You go back to her" },
            { time: 228, text: "And I go back to" },
            { time: 233, text: "Black" },
            { time: 235, text: "..." },
        ],
        [
            { "time": 0, "text": "..." },
            { "time": 32.5, "text": "This is the end" },
            { "time": 37, "text": "Hold your breath and count to ten" },
            { "time": 43.5, "text": "Feel the earth move and then" },
            { "time": 50, "text": "Hear my heart burst again" },
            { "time": 57, "text": "For this is the end" },
            { "time": 62.5, "text": "I've drowned and dreamt this moment" },
            { "time": 69, "text": "So overdue, I owe them" },
            { "time": 75.5, "text": "Swept away, I'm stolen" },
            { "time": 83, "text": "Let the sky fall" },
            { "time": 85.6, "text": "When it crumbles" },
            { "time": 89, "text": "We will stand tall" },
            { "time": 92.5, "text": "Face it all together" },
            { "time": 95.5, "text": "Let the sky fall" },
            { "time": 98.5, "text": "When it crumbles" },
            { "time": 102, "text": "We will stand tall" },
            { "time": 105, "text": "Face it all together" },
            { "time": 108, "text": "At skyfall" },
            { "time": 114, "text": "At skyfall" },
            { "time": 120, "text": "Skyfall is where we start" },
            { "time": 125, "text": "A thousand miles and poles apart" },
            { "time": 132.5, "text": "Where worlds collide and days are dark" },
            { "time": 137, "text": "You may have my number, you can take my name" },
            { "time": 142, "text": "But you'll never have my heart" },
            { "time": 147, "text": "Let the sky fall" },
            { "time": 150, "text": "When it crumbles" },
            { "time": 153.5, "text": "We will stand tall" },
            { "time": 156.5, "text": "Face it all together" },
            { "time": 159, "text": "Let the sky fall" },
            { "time": 162, "text": "When it crumbles" },
            { "time": 165, "text": "We will stand tall" },
            { "time": 169, "text": "Face it all together" },
            { "time": 171, "text": "At skyfall" },
            { "time": 174, "text": "Let the sky fall" },
            { "time": 176, "text": "When it crumbles" },
            { "time": 180, "text": "We will stand tall" },
            { "time": 187, "text": "Let the sky fall" },
            { "time": 189.5, "text": "When it crumbles" },
            { "time": 193.5, "text": "We will stand tall" },
            { "time": 197.5, "text": "Where you go, I go" },
            { "time": 201, "text": "What you see, I see" },
            { "time": 204, "text": "I know I'd never be me" },
            { "time": 208, "text": "Without the security" },
            { "time": 210.5, "text": "Of your loving arms" },
            { "time": 214, "text": "Keeping me from harm" },
            { "time": 217, "text": "Put your hand in my hand" },
            { "time": 220, "text": "And we'll stand" },
            { "time": 223.5, "text": "Let the sky fall" },
            { "time": 227, "text": "When it crumbles" },
            { "time": 230, "text": "We will stand tall" },
            { "time": 232.5, "text": "Face it all together" },
            { "time": 236, "text": "Let the sky fall" },
            { "time": 239.5, "text": "When it crumbles" },
            { "time": 242, "text": "We will stand tall" },
            { "time": 245, "text": "Face it all together" },
            { "time": 248, "text": "At Skyfall" },
            { "time": 250, "text": "Let the sky fall" },
            { "time": 256.5, "text": "We will stand tall" },
            { "time": 260, "text": "At Skyfall" },
            { "time": 265, "text": "Oh" },
            { "time": 273, "text": "..." }
        ],
        [
            { "time": 0, "text": "..." },
            { "time": 11, "text": "This is a man's world" },
            { "time": 16, "text": "This is a man's world" },
            { "time": 22, "text": "But it wouldn't be nothing" },
            { "time": 25, "text": "Nothing without a woman or a girl" },
            { "time": 36, "text": "You see, man made the cars" },
            { "time": 43, "text": "To take us over the road" },
            { "time": 47, "text": "Man made the train" },
            { "time": 53, "text": "To carry the heavy load" },
            { "time": 57.5, "text": "Man made the electric light" },
            { "time": 60.5, "text": "To take us out of the dark" },
            { "time": 66.5, "text": "Man made the boat for the water" },
            { "time": 71, "text": "Like Noah made the ark" },
            { "time": 73.5, "text": "This is a man's, man's, man's world" },
            { "time": 78, "text": "But it wouldn't be nothing" },
            { "time": 80.5, "text": "Nothing without a woman or a girl" },
            { "time": 85, "text": "..." },
            { "time": 93, "text": "Man thinks about a little baby girls and a baby boys" },
            { "time": 102.5, "text": "Man makes them happy" },
            { "time": 106.5, "text": "'Cause man makes them toys" },
            { "time": 110, "text": "And after man's made everything" },
            { "time": 113.5, "text": "Everything he can" },
            { "time": 117, "text": "You know that man makes money" },
            { "time": 120, "text": "To buy from other man" },
            { "time": 126.5, "text": "This is a man's world" },
            { "time": 130.5, "text": "But it wouldn't be nothing" },
            { "time": 133, "text": "Nothing without a woman or a girl" },
            { "time": 144, "text": "He's lost in the wilderness" },
            { "time": 150, "text": "He's lost in bitterness" },
            { "time": 160, "text": "He's lost, lost and" },
            { "time": 167, "text": "..." }
        ],
    ]
};
let song = new Audio();
song.volume = 0.5;
let currentSong = 0;
let repeatMode = false;
let shuffleMode = false;
let shuffledIndices = [];

window.onload = function () {
    playSong();
};

function playSong() {
    song.src = data.song[currentSong];
    document.getElementById("songTitle").textContent = data.title[currentSong];
    document.getElementById("songSinger").textContent = data.singer[currentSong];
    document.getElementsByClassName("song-img")[0].style.backgroundImage = "url(" + data.poster[currentSong] + ")";
    document.getElementsByClassName("song-img")[0].style.boxShadow = data.shadow[currentSong];
    displayLyrics();
    song.play();
    play.classList.remove("fa-play");
    play.classList.add("fa-pause");
    updateTotalTime();
}

function displayLyrics() {
    const lyricsContainer = document.getElementById("lyrics");
    lyricsContainer.innerHTML = '';
    data.lyrics[currentSong].forEach(lyric => {
        const line = document.createElement('div');
        line.className = 'lyric-line';
        line.dataset.time = lyric.time;
        line.textContent = lyric.text;
        lyricsContainer.appendChild(line);
    });
}

function highlightLyric() {
    const currentTime = song.currentTime;
    const lyricsContainer = document.getElementById("lyrics");
    const lines = lyricsContainer.getElementsByClassName('lyric-line');
    for (let i = 0; i < lines.length; i++) {
        const time = parseFloat(lines[i].dataset.time);
        if (currentTime >= time && (i === lines.length - 1 || currentTime < parseFloat(lines[i + 1].dataset.time))) {
            lines[i].classList.add('active');
            lines[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            lines[i].classList.remove('active');
        }
    }
}

song.addEventListener("timeupdate", function () {
    updateProgressBar();
    convertTime(song.currentTime);
    highlightLyric();
    if (song.ended) {
        if (repeatMode) {
            song.currentTime = 0;
            song.play();
        } else {
            next();
        }
    }
});









function playOrPause() {
    let play = document.getElementById("play");
    if (song.paused) {
        song.play();
        play.classList.remove("fa-play");
        play.classList.add("fa-pause");
    } else {
        song.pause();
        play.classList.remove("fa-pause");
        play.classList.add("fa-play");
    }
}

song.addEventListener("timeupdate", function () {
    updateProgressBar();
    convertTime(song.currentTime);
    if (song.ended) {
        if (repeatMode) {
            song.currentTime = 0;
            song.play();
        } else {
            next();
        }
    }
});

function updateProgressBar() {
    let seekBar = document.getElementById("seek-bar");
    let position = (song.currentTime / song.duration) * 100;
    seekBar.value = position;
    seekBar.style.background = `linear-gradient(to right, #FFF ${position}%, #808080 ${position}%)`;
}

document.getElementById("seek-bar").addEventListener("input", function () {
    let seekBar = document.getElementById("seek-bar");
    let seekPosition = (seekBar.value / 100) * song.duration;
    song.currentTime = seekPosition;
    updateProgressBar();
});

document.getElementById("seek-bar").addEventListener("change", function () {
    let seekBar = document.getElementById("seek-bar");
    let seekPosition = (seekBar.value / 100) * song.duration;
    song.currentTime = seekPosition;
    updateProgressBar();
});

function convertTime(seconds) {
    let currentTime = document.getElementById("currentTime");
    let min = Math.floor(seconds / 60);
    let sec = Math.floor(seconds % 60);
    min = (min < 10) ? "0" + min : min;
    sec = (sec < 10) ? "0" + sec : sec;
    currentTime.textContent = min + ":" + sec;
}

function updateTotalTime() {
    song.onloadedmetadata = function () {
        let totalTime = document.getElementById("totalTime");
        let min = Math.floor(song.duration / 60);
        let sec = Math.floor(song.duration % 60);
        min = (min < 10) ? "0" + min : min;
        sec = (sec < 10) ? "0" + sec : sec;
        totalTime.textContent = min + ":" + sec;
        document.getElementById("seek-bar").max = 100;
    }
}

function next() {
    if (shuffleMode) {
        currentSong = getNextShuffledIndex();
    } else {
        currentSong++;
        if (currentSong >= data.song.length) {
            currentSong = 0;
        }
    }
    playSong();
}

function prev() {
    if (shuffleMode) {
        currentSong = getPrevShuffledIndex();
    } else {
        currentSong--;
        if (currentSong < 0) {
            currentSong = data.song.length - 1;
        }
    }
    playSong();
}

function toggleRepeat() {
    repeatMode = !repeatMode;
    let repeatButton = document.querySelector('.fa-repeat');
    if (repeatMode) {
        repeatButton.style.color = '#EAF0FF';
    } else {
        repeatButton.style.color = 'rgba(137, 150, 184, 0.6)';
    }
}

function toggleShuffle() {
    shuffleMode = !shuffleMode;
    let shuffleButton = document.querySelector('.fa-shuffle');
    if (shuffleMode) {
        shuffleButton.style.color = '#EAF0FF';
        shuffledIndices = generateShuffledIndices();
    } else {
        shuffleButton.style.color = 'rgba(137, 150, 184, 0.6)';
        shuffledIndices = [];
    }
}

function generateShuffledIndices() {
    let indices = [...Array(data.song.length).keys()];
    for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    return indices;
}

function getNextShuffledIndex() {
    const currentIndex = shuffledIndices.indexOf(currentSong);
    const nextIndex = (currentIndex + 1) % shuffledIndices.length;
    return shuffledIndices[nextIndex];
}

function getPrevShuffledIndex() {
    const currentIndex = shuffledIndices.indexOf(currentSong);
    const prevIndex = (currentIndex - 1 + shuffledIndices.length) % shuffledIndices.length;
    return shuffledIndices[prevIndex];
}

function toggleVolumeSlider() {
    const volumeContainer = document.getElementById('volume-container');
    volume.style.color = "#EAF0FF"
    if (volumeContainer.classList.contains('hidden')) {
        volumeContainer.classList.remove('hidden');
        volumeContainer.classList.add('visible');
        volumeContainer.style.display = "block"
    } else {
        volumeContainer.classList.remove('visible');
        volumeContainer.classList.add('hidden');
        volumeContainer.style.display = "none"
        volume.style.color = "#8996b899"
    }
}

document.getElementById("volume-slider").addEventListener("input", function () {
    song.volume = this.value / 100;
    this.style.background = `linear-gradient(to right, #fff ${this.value}%, #808080 ${this.value}%)`;
    const volume = document.getElementById("volume")
    if (this.value == 0) {
        volume.classList.remove("fa-volume-low")
        volume.classList.add("fa-volume-xmark")
    }
    else if (this.value == 100) {
        volume.classList.remove("fa-volume-low")
        volume.classList.add("fa-volume-high")
    }
    else if (this.value > 0 || this.value <= 99) {
        volume.classList.remove("fa-volume-xmark")
        volume.classList.remove("fa-volume-high")
        volume.classList.add("fa-volume-low")
    }

});












